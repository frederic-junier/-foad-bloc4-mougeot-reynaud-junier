<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Véronique Reynaud, Brigitte Mougeot, Frédéric Junier" />
  <title>Projet “Mon avenir”, Étape 6, Ateliers admin, TP noté</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="--mathjax" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Projet “Mon avenir”, Étape 6, Ateliers admin, TP noté</h1>
<p class="author">Véronique Reynaud, Brigitte Mougeot, Frédéric Junier</p>
</header>
<nav id="TOC" role="doc-toc">
<h2 id="toc-title">Table des matières</h2>
<ul>
<li><a href="#atelier-admin-n1">Atelier <code>admin</code> n°1</a></li>
<li><a href="#atelier-admin-n2">Atelier <code>admin</code> n°2</a></li>
</ul>
</nav>
<p>Pour commencer, il faut récupérer l’archive <a href="./materiel.zip">materiel.zip</a> puis l’extraire. Dans le répertoire créé on doit avoir l’arborescence ci-dessous :</p>
<p><img src="images/arborescence.png" style="width:25.0%" alt="arborescence" /><br />
</p>
<p>Dans chaque atelier <code>admin</code>, vous devez répondre à un cahier des charges, en complétant pour chaque fonctionnalité demandée :</p>
<ul>
<li>un formulaire <a href="https://developer.mozilla.org/fr/docs/Glossaire/HTML">HTML</a> dans le dossier <em>templates</em></li>
<li>une fonction <strong>contrôleur de route</strong> dans le script Python <code>main.py</code> en vous aidant des activités réalisées à l’étape 4</li>
<li>une page <a href="https://developer.mozilla.org/fr/docs/Glossaire/HTML">HTML</a> retournée par la fonction <strong>contrôleur de route</strong> et placée dans le répertoire <code>templates</code>.</li>
</ul>
<p>Lancer l’application web en exécutant le fichier <code>main.py</code> et se connecter avec le profil <code>admin</code> et le compte d’identifiants <code>(login, password) = (admin, monavenir)</code>. On arrive alors sur l’interface d’accueil du profil.</p>
<p><img src="images/admin.png" alt="connexion" /><br />
</p>
<h1 id="atelier-admin-n1">Atelier <code>admin</code> n°1</h1>
<blockquote>
<p><strong>Cahier des charges :</strong></p>
</blockquote>
<ul>
<li>Créer un fichier Libre-Office <code>compte-rendu.odt</code> à la racine du répertoire <code>materiel</code>.<br />
</li>
<li>Compléter le formulaire dans le fichier <code>statsEtabAvant.html</code> du répertoire <code>templates</code> afin qu’il s’affiche comme ci-dessous lorsqu’on clique sur le lien <code>Formulaire pour générer des statistiques par établissement du supérieur.</code> de l’interface <code>admin</code>.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb1-1"><a href="#cb1-1"></a></span>
<span id="cb1-2"><a href="#cb1-2"></a> <span class="kw">&lt;form</span><span class="ot"> action=</span><span class="st">&quot;/resultatStatsEtabAvant&quot;</span><span class="ot"> method=</span><span class="st">&quot;post&quot;</span><span class="kw">&gt;</span>                    </span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a>                <span class="kw">&lt;ul&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>                    <span class="kw">&lt;li&gt;</span> <span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;/rechercheFormation&quot;</span><span class="kw">&gt;</span>Recherche d&#39;un établissement<span class="kw">&lt;/a&gt;&lt;/li&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>                    <span class="kw">&lt;li&gt;&lt;label</span><span class="ot"> for=</span><span class="st">&#39;idSuperieur&#39;</span><span class="kw">&gt;</span>Identifiant de l&#39;établissement : <span class="kw">&lt;/label&gt;</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>                        <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&#39;text&#39;</span><span class="ot"> id=</span><span class="st">&#39;idSuperieur&#39;</span><span class="ot"> name=</span><span class="st">&#39;idSuperieur&#39;</span><span class="ot"> required</span><span class="kw">&gt;&lt;/li&gt;</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>                </span>
<span id="cb1-9"><a href="#cb1-9"></a>                    <span class="kw">&lt;li&gt;&lt;label</span><span class="ot"> for=</span><span class="st">&quot;total&quot;</span><span class="kw">&gt;</span>Nombre total de candidatures pour l&#39;établissement <span class="kw">&lt;/label&gt;&lt;input</span><span class="ot"> type=</span><span class="st">&quot;checkbox&quot;</span><span class="ot"> id=</span><span class="st">&quot;total&quot;</span><span class="ot"> name=</span><span class="st">&quot;total&quot;</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="ot">                        unchecked</span><span class="kw">&gt;&lt;/li&gt;</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>                    <span class="co">&lt;!--  TO DO , à compléter       --&gt;</span>    </span>
<span id="cb1-12"><a href="#cb1-12"></a>                <span class="kw">&lt;/ul&gt;</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>                    </span>
<span id="cb1-14"><a href="#cb1-14"></a>                <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;submit&quot;</span><span class="ot"> value=</span><span class="st">&quot;Valider&quot;</span><span class="kw">/&gt;</span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="kw">&lt;/form&gt;</span>   </span></code></pre></div>
<p><img src="images/stats_etab_avant.png" alt="Stats etab avant" /><br />
</p>
<ul>
<li>Préciser dans le fichier <code>compte-rendu.odt</code> les étapes successives entre le clic sur le lien <code>Formulaire pour générer des statistiques par établissement du supérieur.</code> et l’affichage de <code>resultatStatsEtabAvant.html</code> dans le navigateur.</li>
</ul>
<p><img src="images/stats_etab_avant.png" alt="compte" /><br />
</p>
<ul>
<li><p>Compléter les cinq fonctions de requêtes dans le <strong>contrôleur de route</strong> <code>resultatStatsEtabAvant</code> du script <code>main.py</code> afin que le clic sur le bouton <code>Envoyer</code> du formulaire dans <code>statsEtabAvant.html</code> permette l’affichage des statistiques sélectionnées dans le formulaire.</p></li>
<li><p>Répondre dans le fichier <code>compte-rendu.odt</code>. Que se passe-t-il si on clique sur les liens <code>Classer les candidatures pour chaque établissement et démarrer la phase de réponses.</code>, <code>Formulaire pour générer des statistiques par établissement du supérieur.</code> ou <code>Formulaire pour générer des statistiques globales.</code> ? Inspecter le fichier <code>main.py</code> pour expliquer ces comportements. Que pourriez-vous faire pour compléter cette application Web ?</p></li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">#controleur de route / URL</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="at">@app.route</span>(<span class="st">&#39;/resultatStatsEtabAvant&#39;</span>, methods <span class="op">=</span> [<span class="st">&#39;POST&#39;</span>])</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw">def</span> resultatStatsEtabAvant():</span>
<span id="cb2-4"><a href="#cb2-4"></a>    <span class="co">&quot;Controleur de la route &#39;/resultatStatsEtabAvant&#39; &quot;</span></span>
<span id="cb2-5"><a href="#cb2-5"></a></span>
<span id="cb2-6"><a href="#cb2-6"></a>    <span class="kw">def</span> requeteNomEtab(conn, cur, idSuperieur):</span>
<span id="cb2-7"><a href="#cb2-7"></a>        <span class="co">##### TO DO  requete SQL pour retrouver l&#39;attribut nom d&#39;un </span></span>
<span id="cb2-8"><a href="#cb2-8"></a>        <span class="co">##### établissement du supérieur à partir de son identifiant idSuperieur</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>        requete <span class="op">=</span> <span class="st">&quot;&quot;&quot; &quot;&quot;&quot;</span></span>
<span id="cb2-10"><a href="#cb2-10"></a>        <span class="cf">return</span> cur.fetchone()[<span class="st">&#39;nom&#39;</span>]</span>
<span id="cb2-11"><a href="#cb2-11"></a> </span>
<span id="cb2-12"><a href="#cb2-12"></a></span>
<span id="cb2-13"><a href="#cb2-13"></a>    <span class="kw">def</span> requeteTotalCandidature(conn, cur, idSuperieur):</span>
<span id="cb2-14"><a href="#cb2-14"></a>        <span class="co">##### TO DO  requete SQL pour retrouver le nombre total de candidatures pour l&#39;établissement</span></span>
<span id="cb2-15"><a href="#cb2-15"></a>        <span class="co">##### établissement du supérieur à partir de son identifiant idSuperieur</span></span>
<span id="cb2-16"><a href="#cb2-16"></a>        requete <span class="op">=</span> <span class="st">&quot;&quot;&quot; &quot;&quot;&quot;</span></span>
<span id="cb2-17"><a href="#cb2-17"></a>        <span class="cf">return</span> <span class="bu">int</span>(cur.fetchone()[<span class="st">&#39;total&#39;</span>])</span>
<span id="cb2-18"><a href="#cb2-18"></a></span>
<span id="cb2-19"><a href="#cb2-19"></a>    <span class="kw">def</span> requeteSeuilAdmis(conn, cur, idSuperieur):</span>
<span id="cb2-20"><a href="#cb2-20"></a>        <span class="co">##### TO DO  requete SQL pour calculer la moyenne du dernier admis de la liste d&#39;appel </span></span>
<span id="cb2-21"><a href="#cb2-21"></a>        <span class="co">##### renommage indispensable de cette moyenne avec le nom  &#39;seuil&#39;</span></span>
<span id="cb2-22"><a href="#cb2-22"></a>        <span class="co">##### Pour obtenir le nombre d&#39;admis dans la liste d&#39;appel :</span></span>
<span id="cb2-23"><a href="#cb2-23"></a>        <span class="co">##### &quot;SELECT nbAdmis FROM superieur WHERE idSuperieur = ... &quot;</span></span>
<span id="cb2-24"><a href="#cb2-24"></a>        requete <span class="op">=</span> <span class="st">&quot;&quot;&quot; &quot;&quot;&quot;</span></span>
<span id="cb2-25"><a href="#cb2-25"></a>        cur.execute(requete, (idSuperieur,idSuperieur))</span>
<span id="cb2-26"><a href="#cb2-26"></a>        <span class="cf">return</span> <span class="bu">float</span>(cur.fetchone()[<span class="st">&#39;seuil&#39;</span>])</span>
<span id="cb2-27"><a href="#cb2-27"></a>     </span>
<span id="cb2-28"><a href="#cb2-28"></a></span>
<span id="cb2-29"><a href="#cb2-29"></a>    <span class="kw">def</span> requeteSeuilAttente(conn, cur, idSuperieur):</span>
<span id="cb2-30"><a href="#cb2-30"></a>        <span class="co">##### TO DO  requete SQL pour calculer la moyenne du dernier en attente dans la liste d&#39;appel</span></span>
<span id="cb2-31"><a href="#cb2-31"></a>        <span class="co">##### renommage indispensable de cette moyenne avec le nom  &#39;seuil&#39; </span></span>
<span id="cb2-32"><a href="#cb2-32"></a>        <span class="co">##### Pour obtenir le nombre total (admis + en attente) dans la liste d&#39;appel :</span></span>
<span id="cb2-33"><a href="#cb2-33"></a>        <span class="co">##### &quot;SELECT nbAppel FROM superieur WHERE idSuperieur = ... ;&quot;</span></span>
<span id="cb2-34"><a href="#cb2-34"></a>        requete <span class="op">=</span> <span class="st">&quot;&quot;&quot;        &quot;&quot;&quot;</span></span>
<span id="cb2-35"><a href="#cb2-35"></a>        cur.execute(requete, (idSuperieur,idSuperieur))</span>
<span id="cb2-36"><a href="#cb2-36"></a>        <span class="cf">return</span> <span class="bu">float</span>(cur.fetchone()[<span class="st">&#39;seuil&#39;</span>])</span>
<span id="cb2-37"><a href="#cb2-37"></a>    </span>
<span id="cb2-38"><a href="#cb2-38"></a>      </span>
<span id="cb2-39"><a href="#cb2-39"></a>    <span class="kw">def</span> requeteListeCandidatureLycee(conn, cur, idSuperieur):</span>
<span id="cb2-40"><a href="#cb2-40"></a>        <span class="co">##### TO DO  requete SQL pour déterminer le nombre de candidatures </span></span>
<span id="cb2-41"><a href="#cb2-41"></a>        <span class="co">##### pour un établissement du supérieur et par lycée </span></span>
<span id="cb2-42"><a href="#cb2-42"></a>        <span class="co">##### renommage indispensable : nb pour le nombre et nom pour le nom du lycée </span></span>
<span id="cb2-43"><a href="#cb2-43"></a>        requete <span class="op">=</span> <span class="st">&quot;&quot;&quot;     &quot;&quot;&quot;</span></span>
<span id="cb2-44"><a href="#cb2-44"></a>        cur.execute(requete, (idSuperieur,))</span>
<span id="cb2-45"><a href="#cb2-45"></a>        <span class="cf">return</span> cur.fetchall()</span>
<span id="cb2-46"><a href="#cb2-46"></a></span>
<span id="cb2-47"><a href="#cb2-47"></a></span>
<span id="cb2-48"><a href="#cb2-48"></a>    <span class="co">#analyse du formulaire</span></span>
<span id="cb2-49"><a href="#cb2-49"></a>    <span class="cf">if</span> request.method <span class="op">==</span> <span class="st">&#39;POST&#39;</span>:   </span>
<span id="cb2-50"><a href="#cb2-50"></a>        <span class="co">#ouverture du formulaire</span></span>
<span id="cb2-51"><a href="#cb2-51"></a>        result <span class="op">=</span> request.form</span>
<span id="cb2-52"><a href="#cb2-52"></a>        idSuperieur <span class="op">=</span> result[<span class="st">&#39;idSuperieur&#39;</span>]</span>
<span id="cb2-53"><a href="#cb2-53"></a>        <span class="co">#ouverture de la BDD</span></span>
<span id="cb2-54"><a href="#cb2-54"></a>        conn <span class="op">=</span> sqlite3.<span class="ex">connect</span>(<span class="st">&#39;monavenir.db&#39;</span>)  </span>
<span id="cb2-55"><a href="#cb2-55"></a>        conn.row_factory <span class="op">=</span>  sqlite3.Row  <span class="co">#pour récupérer les lignes sous forme de dictionnaire           </span></span>
<span id="cb2-56"><a href="#cb2-56"></a>        cur <span class="op">=</span> conn.cursor()</span>
<span id="cb2-57"><a href="#cb2-57"></a>        <span class="co">#requete sur le nom de l&#39;établissement</span></span>
<span id="cb2-58"><a href="#cb2-58"></a>        nom <span class="op">=</span> requeteNomEtab(conn, cur, idSuperieur)</span>
<span id="cb2-59"><a href="#cb2-59"></a>        <span class="co">#initialisation du dictionnaire de statistiques</span></span>
<span id="cb2-60"><a href="#cb2-60"></a>        stats <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb2-61"><a href="#cb2-61"></a>        stats[<span class="st">&#39;nom&#39;</span>] <span class="op">=</span> nom</span>
<span id="cb2-62"><a href="#cb2-62"></a>        <span class="co">#on peuple stats avec les résultats des requetes, une  par paramètre transmis par le formulaire</span></span>
<span id="cb2-63"><a href="#cb2-63"></a>        <span class="cf">if</span> <span class="st">&#39;total&#39;</span> <span class="kw">in</span> result:            </span>
<span id="cb2-64"><a href="#cb2-64"></a>            stats[<span class="st">&#39;total&#39;</span>] <span class="op">=</span> requeteTotalCandidature(conn, cur, idSuperieur)</span>
<span id="cb2-65"><a href="#cb2-65"></a>        <span class="cf">if</span> <span class="st">&#39;seuilAdmis&#39;</span>  <span class="kw">in</span> result:</span>
<span id="cb2-66"><a href="#cb2-66"></a>            stats[<span class="st">&#39;seuilAdmis&#39;</span>] <span class="op">=</span> requeteSeuilAdmis(conn, cur, idSuperieur)</span>
<span id="cb2-67"><a href="#cb2-67"></a>        <span class="cf">if</span> <span class="st">&#39;seuilAttente&#39;</span>  <span class="kw">in</span> result:            </span>
<span id="cb2-68"><a href="#cb2-68"></a>            stats[<span class="st">&#39;seuilAttente&#39;</span>] <span class="op">=</span> requeteSeuilAttente(conn, cur, idSuperieur)</span>
<span id="cb2-69"><a href="#cb2-69"></a>        <span class="cf">if</span> <span class="st">&#39;candidLycee&#39;</span>  <span class="kw">in</span> result:</span>
<span id="cb2-70"><a href="#cb2-70"></a>            stats[<span class="st">&#39;candidLycee&#39;</span>] <span class="op">=</span> requeteListeCandidatureLycee(conn, cur, idSuperieur)</span>
<span id="cb2-71"><a href="#cb2-71"></a>        <span class="co">#fermeture de la BDD</span></span>
<span id="cb2-72"><a href="#cb2-72"></a>        cur.close()</span>
<span id="cb2-73"><a href="#cb2-73"></a>        conn.close()</span>
<span id="cb2-74"><a href="#cb2-74"></a>        <span class="co">#renvoi du template</span></span>
<span id="cb2-75"><a href="#cb2-75"></a>        <span class="cf">return</span> render_template(<span class="st">&quot;resultatStatsEtabAvant.html&quot;</span>, stats <span class="op">=</span> stats)</span></code></pre></div>
<h1 id="atelier-admin-n2">Atelier <code>admin</code> n°2</h1>
<blockquote>
<p><strong>Cahier des charges :</strong></p>
</blockquote>
<ul>
<li>Créer un fichier Libre-Office <code>compte-rendu.odt</code> à la racine du répertoire <code>materiel</code>.</li>
<li>Compléter le formulaire dans le fichier <code>statsGeneralAvant.html</code> du répertoire <code>templates</code> afin qu’il s’affiche comme ci-dessous lorsqu’on clique sur le lien <code>Formulaire pour générer des statistiques globales.</code> de l’interface <code>admin</code>.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb3-1"><a href="#cb3-1"></a>  <span class="kw">&lt;form</span><span class="ot"> action=</span><span class="st">&quot;/resultatStatsGeneralAvant&quot;</span><span class="ot"> method=</span><span class="st">&quot;post&quot;</span><span class="kw">&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>            </span>
<span id="cb3-3"><a href="#cb3-3"></a>            <span class="kw">&lt;ul&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>                <span class="kw">&lt;li&gt;&lt;label</span><span class="ot"> for=</span><span class="st">&quot;moyVoeux&quot;</span><span class="kw">&gt;</span>Nombre moyen de voeux par candidat <span class="kw">&lt;/label&gt;</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>                    <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;checkbox&quot;</span><span class="ot"> id=</span><span class="st">&quot;moyVoeux&quot;</span><span class="ot"> name=</span><span class="st">&quot;moyVoeux&quot;</span><span class="ot">  unchecked</span><span class="kw">&gt;</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>                <span class="kw">&lt;/li&gt;</span></span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a>                <span class="co">&lt;!--  TO DO , à compléter       --&gt;</span>   </span>
<span id="cb3-9"><a href="#cb3-9"></a>                </span>
<span id="cb3-10"><a href="#cb3-10"></a>                <span class="kw">&lt;li&gt;&lt;label</span><span class="ot"> for=</span><span class="st">&quot;maxCandid&quot;</span><span class="kw">&gt;</span>Liste des établissements les plus demandés <span class="kw">&lt;/label&gt;</span></span>
<span id="cb3-11"><a href="#cb3-11"></a>                    <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;checkbox&quot;</span><span class="ot"> id=</span><span class="st">&quot;maxCandid&quot;</span><span class="ot"> name=</span><span class="st">&quot;maxCandid&quot;</span><span class="ot">  unchecked</span><span class="kw">&gt;</span></span>
<span id="cb3-12"><a href="#cb3-12"></a>                <span class="kw">&lt;/li&gt;</span>          </span>
<span id="cb3-13"><a href="#cb3-13"></a>               </span>
<span id="cb3-14"><a href="#cb3-14"></a>            <span class="kw">&lt;/ul&gt;</span></span>
<span id="cb3-15"><a href="#cb3-15"></a>                </span>
<span id="cb3-16"><a href="#cb3-16"></a>            <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;submit&quot;</span><span class="ot"> value=</span><span class="st">&quot;Valider&quot;</span><span class="kw">/&gt;</span></span>
<span id="cb3-17"><a href="#cb3-17"></a>    <span class="kw">&lt;/form&gt;</span></span></code></pre></div>
<p><img src="images/stats_general_avant.png" alt="Stats etab avant" /><br />
</p>
<ul>
<li>Préciser dans le fichier <code>compte-rendu.odt</code> les étapes successives entre le clic sur le lien <code>Formulaire pour générer des statistiques globales.</code> et l’affichage de <code>resultatStatsGeneralAvant.html</code> dans le navigateur.</li>
</ul>
<p><img src="images/parametre_stats_generale_avant.png" alt="Stats generale avant" /><br />
</p>
<ul>
<li><p>Compléter les cinq fonctions de requêtes dans le <strong>contrôleur de route</strong> <code>resultatStatsEtabAvant</code> du script <code>main.py</code> afin que le clic sur le bouton <code>Envoyer</code> du formulaire dans <code>statsEtabAvant.html</code> permette l’affichage des statistiques sélectionnées dans le formulaire.</p></li>
<li><p>Répondre dans le fichier <code>compte-rendu.odt</code>. Que se passe-t-il si on clique sur les liens <code>Classer les candidatures pour chaque établissement et démarrer la phase de réponses.</code>, <code>Formulaire pour générer des statistiques par établissement du supérieur.</code> ou <code>Formulaire pour générer des statistiques globales.</code> ? Inspecter le fichier <code>main.py</code> pour expliquer ces comportements. Que pourriez-vous faire pour compléter cette application Web ?</p></li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">#controleur de route / URL</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="at">@app.route</span>(<span class="st">&#39;/resultatStatsGeneralAvant&#39;</span>, methods <span class="op">=</span> [<span class="st">&#39;POST&#39;</span>])</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="kw">def</span> resultatStatsGeneralAvant():</span>
<span id="cb4-4"><a href="#cb4-4"></a>    <span class="co">&quot;Controleur de la route &#39;/resultatStatsGeneralAvant&#39; &quot;</span></span>
<span id="cb4-5"><a href="#cb4-5"></a></span>
<span id="cb4-6"><a href="#cb4-6"></a>    <span class="kw">def</span> requeteNombreCandidatureParEtab(conn, cur):</span>
<span id="cb4-7"><a href="#cb4-7"></a>        <span class="co">##### TO DO  requete SQL pour déterminer le nombre de candidatures par établissement</span></span>
<span id="cb4-8"><a href="#cb4-8"></a>        <span class="co">##### Renommage obligatoire de ce nombre avec le nom &#39;nb&#39;</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>        requete <span class="op">=</span> <span class="st">&quot;&quot;&quot; &quot;&quot;&quot;</span></span>
<span id="cb4-10"><a href="#cb4-10"></a>        cur.execute(requete)</span>
<span id="cb4-11"><a href="#cb4-11"></a>        <span class="cf">return</span> cur.fetchall()</span>
<span id="cb4-12"><a href="#cb4-12"></a></span>
<span id="cb4-13"><a href="#cb4-13"></a></span>
<span id="cb4-14"><a href="#cb4-14"></a>    <span class="kw">def</span> requeteMoyParEtab(conn, cur):</span>
<span id="cb4-15"><a href="#cb4-15"></a>        <span class="co">##### TO DO  requete SQL pour déterminer le nombre de candidatures par établissement</span></span>
<span id="cb4-16"><a href="#cb4-16"></a>        <span class="co">##### Renommage obligatoire du nom de l&#39;établissement en &#39;nomEtab&#39;</span></span>
<span id="cb4-17"><a href="#cb4-17"></a>        <span class="co">##### Renommage obligatoire de la moyenne en &#39;moyEtab&#39;</span></span>
<span id="cb4-18"><a href="#cb4-18"></a>        requete <span class="op">=</span> <span class="st">&quot;&quot;&quot;   &quot;&quot;&quot;</span></span>
<span id="cb4-19"><a href="#cb4-19"></a>        cur.execute(requete)</span>
<span id="cb4-20"><a href="#cb4-20"></a>        <span class="cf">return</span> cur.fetchall()</span>
<span id="cb4-21"><a href="#cb4-21"></a></span>
<span id="cb4-22"><a href="#cb4-22"></a></span>
<span id="cb4-23"><a href="#cb4-23"></a></span>
<span id="cb4-24"><a href="#cb4-24"></a>    <span class="kw">def</span> requeteNbMoyenCandidatures(conn, cur):</span>
<span id="cb4-25"><a href="#cb4-25"></a>        <span class="co">##### TO DO  requete SQL pour déterminer le nombre moyen  de candidatures par élève</span></span>
<span id="cb4-26"><a href="#cb4-26"></a>        <span class="co">##### Renommage obligatoire de la moyenne  en &#39;moyVoeux&#39;</span></span>
<span id="cb4-27"><a href="#cb4-27"></a>        requete <span class="op">=</span> <span class="st">&quot;&quot;&quot;  &quot;&quot;&quot;</span></span>
<span id="cb4-28"><a href="#cb4-28"></a>        cur.execute(requete)</span>
<span id="cb4-29"><a href="#cb4-29"></a>        <span class="cf">return</span> <span class="bu">int</span>(cur.fetchone()[<span class="st">&#39;moyVoeux&#39;</span>])</span>
<span id="cb4-30"><a href="#cb4-30"></a></span>
<span id="cb4-31"><a href="#cb4-31"></a>    </span>
<span id="cb4-32"><a href="#cb4-32"></a>    <span class="kw">def</span> requeteListeEtabMaxCandidatures(conn, cur):</span>
<span id="cb4-33"><a href="#cb4-33"></a>        <span class="co">##### TO DO  requete SQL pour déterminer la liste des établissements </span></span>
<span id="cb4-34"><a href="#cb4-34"></a>        <span class="co">##### avec le nombre maximal de candidatures  </span></span>
<span id="cb4-35"><a href="#cb4-35"></a>        requete <span class="op">=</span> <span class="st">&quot;&quot;&quot;   &quot;&quot;&quot;</span>        </span>
<span id="cb4-36"><a href="#cb4-36"></a>        cur.execute(requete)</span>
<span id="cb4-37"><a href="#cb4-37"></a>        <span class="cf">return</span> cur.fetchall()</span>
<span id="cb4-38"><a href="#cb4-38"></a>  </span>
<span id="cb4-39"><a href="#cb4-39"></a></span>
<span id="cb4-40"><a href="#cb4-40"></a></span>
<span id="cb4-41"><a href="#cb4-41"></a>    <span class="co">#analyse du formulaire</span></span>
<span id="cb4-42"><a href="#cb4-42"></a>    <span class="cf">if</span> request.method <span class="op">==</span> <span class="st">&#39;POST&#39;</span>:   </span>
<span id="cb4-43"><a href="#cb4-43"></a>        <span class="co">#ouverture du formulaire</span></span>
<span id="cb4-44"><a href="#cb4-44"></a>        result <span class="op">=</span> request.form</span>
<span id="cb4-45"><a href="#cb4-45"></a>        <span class="co">#ouverture de la BDD</span></span>
<span id="cb4-46"><a href="#cb4-46"></a>        conn <span class="op">=</span> sqlite3.<span class="ex">connect</span>(<span class="st">&#39;monavenir.db&#39;</span>)  </span>
<span id="cb4-47"><a href="#cb4-47"></a>        conn.row_factory <span class="op">=</span>  sqlite3.Row  <span class="co">#pour récupérer les lignes sous forme de dictionnaire           </span></span>
<span id="cb4-48"><a href="#cb4-48"></a>        cur <span class="op">=</span> conn.cursor()</span>
<span id="cb4-49"><a href="#cb4-49"></a>        <span class="co">#initialisation du dictionnaire conteneur de stats</span></span>
<span id="cb4-50"><a href="#cb4-50"></a>        stats <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb4-51"><a href="#cb4-51"></a>        <span class="cf">if</span> <span class="st">&#39;totalEtab&#39;</span> <span class="kw">in</span> result:            </span>
<span id="cb4-52"><a href="#cb4-52"></a>            stats[<span class="st">&#39;totalEtab&#39;</span>] <span class="op">=</span> requeteNombreCandidatureParEtab(conn, cur)</span>
<span id="cb4-53"><a href="#cb4-53"></a>        <span class="cf">if</span> <span class="st">&#39;sousAppel&#39;</span>  <span class="kw">in</span> result:            </span>
<span id="cb4-54"><a href="#cb4-54"></a>            stats[<span class="st">&#39;sousAppel&#39;</span>] <span class="op">=</span> requeteEtabAvecSousAppel(conn, cur)</span>
<span id="cb4-55"><a href="#cb4-55"></a>        <span class="cf">if</span> <span class="st">&#39;moyEtab&#39;</span>  <span class="kw">in</span> result:            </span>
<span id="cb4-56"><a href="#cb4-56"></a>            stats[<span class="st">&#39;moyEtab&#39;</span>] <span class="op">=</span> requeteMoyParEtab(conn, cur)</span>
<span id="cb4-57"><a href="#cb4-57"></a>        <span class="cf">if</span> <span class="st">&#39;moyVoeux&#39;</span> <span class="kw">in</span> result:            </span>
<span id="cb4-58"><a href="#cb4-58"></a>            stats[<span class="st">&#39;moyVoeux&#39;</span>] <span class="op">=</span> requeteNbMoyenCandidatures(conn, cur)    </span>
<span id="cb4-59"><a href="#cb4-59"></a>        <span class="cf">if</span> <span class="st">&#39;maxCandid&#39;</span>  <span class="kw">in</span> result:            </span>
<span id="cb4-60"><a href="#cb4-60"></a>            stats[<span class="st">&#39;maxCandid&#39;</span>] <span class="op">=</span> requeteListeEtabMaxCandidatures(conn, cur)</span>
<span id="cb4-61"><a href="#cb4-61"></a>        <span class="co">#fermeture de la BDD</span></span>
<span id="cb4-62"><a href="#cb4-62"></a>        cur.close()</span>
<span id="cb4-63"><a href="#cb4-63"></a>        conn.close()</span>
<span id="cb4-64"><a href="#cb4-64"></a>        <span class="cf">return</span> render_template(<span class="st">&#39;resultatStatsGeneralAvant.html&#39;</span>, stats <span class="op">=</span> stats)</span></code></pre></div>
</body>
</html>
